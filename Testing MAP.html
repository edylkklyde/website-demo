<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Penaranda Tourist Map</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
/* RESET */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { height: 100%; width: 100%; }

/* MAP */
#map { height: 100vh; width: 100%; }

/* HEADER MENU */
header {
  position: fixed; top: 10px; left: 10px; z-index: 1100;
}
#menu-btn {
  background: #1e90ff; color: white; border: none;
  padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 16px;
  transition: background 0.3s; z-index: 1101;
}
#menu-btn:hover { background: #0077e6; }

/* BOTTOM MENU */
#popup-nav {
  position: fixed; bottom: -100%; left: 0; width: 100%; height: 250px;
  background: white; border-radius: 10px 10px 0 0; box-shadow: 0 -4px 15px rgba(0,0,0,0.3);
  padding: 20px; transition: bottom 0.4s ease; z-index: 1100; pointer-events: none;
}
#popup-nav.show { bottom: 0; pointer-events: auto; }
#popup-nav ul { list-style: none; display: flex; justify-content: space-around; }
#popup-nav a { text-decoration: none; color: #1e90ff; font-weight: bold; }
#popup-nav a:hover { color: #0077e6; }

/* OVERLAY */
#overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.3); opacity: 0; pointer-events: none; z-index: 1099;
  transition: opacity 0.3s;
}
#overlay.active { opacity: 1; pointer-events: auto; }

/* SIDE PANEL */
#side-panel {
  position: fixed; top: 0; right: -500px; width: 500px; height: 100%;
  background: #fff; box-shadow: -4px 0 15px rgba(0,0,0,0.3); z-index: 998;
  transition: right 0.4s ease; padding: 20px; overflow-y: auto;
}
#side-panel.show { right: 0; }
#side-panel h2 { margin-bottom: 10px; }
#side-panel .close-btn {
  position: absolute;
  bottom: 20px;      /* bottom center */
  left: 50%;
  transform: translateX(-50%);
  background: #1e90ff;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 8px 20px;
  cursor: pointer;
}
#side-panel .close-btn:hover { background: #0077e6; }

/* MARKERS */
.blue-circle {
  background-color: blue; width: 24px; height: 24px; border-radius: 50%;
  border: 3px solid white; transition: transform 0.3s ease, opacity 0.3s ease;
}
.blue-circle.shrink { transform: scale(0); opacity: 0; }

.glow-marker {
  width: 20px; height: 20px; background: #43a7ff; border-radius: 50%;
  box-shadow: 0 0 10px #43a7ff, 0 0 20px #43a7ff;
}
</style>
</head>
<body>

<header>
  <button id="menu-btn">â˜° Menu</button>
  <nav id="popup-nav">
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#">Tourist Spots</a></li>
      <li><a href="#">About</a></li>
      <li><a href="#">Contact</a></li>
    </ul>
  </nav>
</header>

<div id="overlay"></div>

<!-- Side Panel -->
<div id="side-panel">
  <div id="panel-content"></div>
  <button class="close-btn">Close</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* MENU TOGGLE */
const menuBtn = document.getElementById("menu-btn");
const popupNav = document.getElementById("popup-nav");
const overlay = document.getElementById("overlay");

menuBtn.addEventListener("click", () => {
  popupNav.classList.toggle("show");
  overlay.classList.toggle("active");
});
overlay.addEventListener("click", () => {
  popupNav.classList.remove("show");
  overlay.classList.remove("active");
});

/* MAP INIT */
const map = L.map("map", { zoomControl: false }).setView([15.355, 121.0], 13);
L.control.zoom({ position: "topright" }).addTo(map);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

/* TOURIST LOCATIONS */
const locations = [
  { name: "Municipal Hall", lat: 15.36529, lng: 121.01422, description: "The municipal hall of Penaranda, open 8AM-5PM." },
  { name: "Penaranda Arc", lat: 15.35402, lng: 120.98146, description: "A historical arc in Penaranda, popular for photos." },
  { name: "Penaranda Irrigation", lat: 15.34847, lng: 121.00990, description: "Famous irrigation site built in the 1900s." },
  { name: "Saint Francis Church", lat: 15.35370, lng: 121.00218, description: "Beautiful old church with unique architecture." },
  { name: "One Bella Food Park", lat: 15.35642, lng: 120.98493, description: "Food park offering local delicacies and snacks." }
];

const circleIcon = L.divIcon({ className: "blue-circle", iconSize:[24,24] });
const bluePin = L.icon({
  iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",
  shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",
  iconSize: [25,41], iconAnchor:[12,41], popupAnchor:[1,-34]
});

/* SIDE PANEL ELEMENTS */
const sidePanel = document.getElementById("side-panel");
const panelContent = document.getElementById("panel-content");
const closeBtn = sidePanel.querySelector(".close-btn");
closeBtn.addEventListener("click", () => sidePanel.classList.remove("show"));

/* TOURIST MARKERS WITH SIDE PANEL ON CLICK */
locations.forEach((loc, index) => {
  let isPin = false;
  let marker = L.marker([loc.lat, loc.lng], { icon: circleIcon }).addTo(map);
  marker.bindTooltip(loc.name, { direction: "top", opacity: 0.8 });

  function handleClick() {
    const el = marker.getElement();
    if (!el) return;
    el.classList.add("shrink");

    setTimeout(() => {
      map.removeLayer(marker);
      if (!isPin) {
        marker = L.marker([loc.lat, loc.lng], { icon: bluePin }).addTo(map);
        marker.bindPopup(`<b>${loc.name}</b>`);
        isPin = true;
      } else {
        marker = L.marker([loc.lat, loc.lng], { icon: circleIcon }).addTo(map);
        marker.bindTooltip(loc.name, { direction: "top", opacity: 0.8 });
        isPin = false;
      }
      marker.on("click", handleClick);

      // Show side panel with numbered info
      panelContent.innerHTML = `<h2>${index+1}. ${loc.name}</h2><p>${loc.description}</p>`;
      sidePanel.classList.add("show");
    }, 300);
  }

  marker.on("click", handleClick);
});

/* USER LOCATION TRACKING */
let userMarker = null;
let accuracyCircle = null;
let firstUpdate = true;

const glowingIcon = L.divIcon({ className: "glow-marker", iconSize:[20,20] });

if (navigator.geolocation) {
  navigator.geolocation.watchPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const accuracy = pos.coords.accuracy;
      const newLatLng = [lat, lng];

      if (!userMarker) userMarker = L.marker(newLatLng, { icon: glowingIcon }).addTo(map);
      else userMarker.setLatLng(newLatLng);

      if (!accuracyCircle) {
        accuracyCircle = L.circle(newLatLng, {
          radius: accuracy,
          color: "#1e90ff",
          fillColor: "#1e90ff",
          fillOpacity: 0.3
        }).addTo(map);
      } else {
        accuracyCircle.setLatLng(newLatLng);
        accuracyCircle.setRadius(accuracy);
      }

      if (firstUpdate) {
        map.setView(newLatLng, 16);
        firstUpdate = false;
      }
    },
    () => alert("Unable to access your location."),
    { enableHighAccuracy: true, maximumAge: 5000, timeout: 10000 }
  );
} else { alert("Geolocation not supported."); }
</script>
</body>
</html>
